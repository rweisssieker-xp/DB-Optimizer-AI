<UserControl x:Class="DBOptimizer.WpfApp.Views.AiHealthDashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1400">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="🏥 AI System Health Dashboard" FontSize="26" FontWeight="Bold"/>
            <TextBlock Text="Umfassender Überblick über Ihre DBOptimizer System-Gesundheit"
                      Foreground="#757575" Margin="0,5,0,0"/>
        </StackPanel>

        <!-- Action Bar -->
        <Border Grid.Row="1" Background="#F5F5F5" BorderBrush="#E0E0E0" BorderThickness="1"
               CornerRadius="10" Padding="15" Margin="0,0,0,20">
            <StackPanel Orientation="Horizontal">
                <Button Content="🔄 Health Score Berechnen" Command="{Binding CalculateHealthScoreCommand}"
                       Background="#4CAF50" Foreground="White" FontWeight="Bold"
                       Height="40" Padding="20,0" BorderThickness="0" Cursor="Hand"/>

                <Button Content="📊 Historie" Command="{Binding ViewHistoryCommand}"
                       Background="#2196F3" Foreground="White" FontWeight="Bold"
                       Height="40" Padding="20,0" BorderThickness="0" Cursor="Hand" Margin="10,0,0,0"/>

                <Button Content="💾 Report Exportieren" Command="{Binding ExportReportCommand}"
                       Background="#9C27B0" Foreground="White" FontWeight="Bold"
                       Height="40" Padding="20,0" BorderThickness="0" Cursor="Hand" Margin="10,0,0,0"/>

                <TextBlock Text="{Binding StatusMessage}" VerticalAlignment="Center"
                          Foreground="#757575" Margin="20,0,0,0" FontSize="12"/>

                <!-- Loading Indicator -->
                <Border Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                       Background="#FFF9C4" BorderBrush="#FBC02D" BorderThickness="1" CornerRadius="5"
                       Padding="10,5" Margin="20,0,0,0">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="⏳" FontSize="18" Margin="0,0,8,0"/>
                        <TextBlock Text="Berechne..." FontWeight="SemiBold" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Border>

        <!-- Main Health Score Display -->
        <Border Grid.Row="2" Background="White" BorderBrush="#E0E0E0" BorderThickness="2"
               CornerRadius="15" Padding="30" Margin="0,0,0,20"
               Visibility="{Binding CurrentHealthScore, Converter={StaticResource NullToVisibilityConverter}}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Overall Score Circle -->
                <Border Grid.Column="0" Width="180" Height="180" CornerRadius="90"
                       Background="{Binding HealthStatusColor}" Margin="0,0,30,0">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <TextBlock Text="{Binding HealthStatusIcon}" FontSize="40" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding OverallScore}" FontSize="60" FontWeight="Bold"
                                  Foreground="White" HorizontalAlignment="Center"/>
                        <TextBlock Text="/100" FontSize="20" Foreground="White" HorizontalAlignment="Center" Margin="0,-10,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Score Details -->
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="{Binding HealthStatus}" FontSize="32" FontWeight="Bold"
                              Foreground="{Binding HealthStatusColor}"/>
                    <TextBlock Text="{Binding ScoreChangeText}" FontSize="20" FontWeight="SemiBold"
                              Foreground="{Binding ScoreChangeColor}" Margin="0,5,0,0"/>
                    <TextBlock Text="{Binding CurrentHealthScore.Timestamp, StringFormat='Letzte Berechnung: {0:dd.MM.yyyy HH:mm:ss}'}"
                              FontSize="12" Foreground="#757575" Margin="0,10,0,0"/>
                </StackPanel>

                <!-- Top Action Callout -->
                <Border Grid.Column="2" Background="#FFF3E0" BorderBrush="#FF9800" BorderThickness="2"
                       CornerRadius="10" Padding="20" Width="350"
                       Visibility="{Binding TopImpactAction, Converter={StaticResource NullToVisibilityConverter}}">
                    <StackPanel>
                        <TextBlock Text="💡 Top Impact Action" FontSize="16" FontWeight="Bold" Foreground="#E65100"/>
                        <TextBlock Text="{Binding TopImpactAction.Title}" FontSize="14" FontWeight="SemiBold"
                                  TextWrapping="Wrap" Margin="0,8,0,5"/>
                        <TextBlock Text="{Binding TopImpactAction.Description}" FontSize="11" TextWrapping="Wrap"
                                  Foreground="#757575" Margin="0,0,0,10"/>
                        <StackPanel Orientation="Horizontal">
                            <Border Background="{Binding TopImpactAction.PriorityColor}" CornerRadius="3" Padding="8,3">
                                <TextBlock Text="{Binding TopImpactAction.Priority}" Foreground="White"
                                          FontSize="10" FontWeight="Bold"/>
                            </Border>
                            <TextBlock Text="{Binding TopImpactAction.EstimatedScoreImpact, StringFormat='Impact: +{0} Punkte'}"
                                      FontSize="11" FontWeight="SemiBold" Margin="10,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Category Scores and Actions -->
        <Grid Grid.Row="3" Visibility="{Binding CurrentHealthScore, Converter={StaticResource NullToVisibilityConverter}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Category Breakdown -->
            <Border Grid.Column="0" Background="White" BorderBrush="#E0E0E0" BorderThickness="2"
                   CornerRadius="10" Padding="20" Margin="0,0,10,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="📊 Category Breakdown" FontSize="20" FontWeight="Bold" Margin="0,0,0,20"/>

                        <!-- SQL Performance Category -->
                        <Border Background="#E3F2FD" BorderBrush="#2196F3" BorderThickness="2" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                            <StackPanel>
                                <Grid>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding SqlPerformanceCategory.StatusIcon}" FontSize="24" Margin="0,0,10,0"/>
                                        <TextBlock Text="{Binding SqlPerformanceCategory.Name}" FontSize="18" FontWeight="Bold" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                        <TextBlock Text="{Binding SqlPerformanceCategory.Score}" FontSize="28" FontWeight="Bold"
                                                  Foreground="{Binding SqlPerformanceCategory.StatusColor}" VerticalAlignment="Center"/>
                                        <TextBlock Text="/100" FontSize="14" Foreground="#757575" Margin="2,6,0,0"/>
                                    </StackPanel>
                                </Grid>

                                <Border Background="{Binding SqlPerformanceCategory.StatusColor}" Height="6" CornerRadius="3" Margin="0,10,0,10"
                                       Width="{Binding SqlPerformanceCategory.Score}" HorizontalAlignment="Left" MaxWidth="400"/>

                                <TextBlock Text="{Binding SqlPerformanceCategory.StatusText}" FontWeight="SemiBold" FontSize="12"
                                          Foreground="{Binding SqlPerformanceCategory.StatusColor}" Margin="0,0,0,10"/>

                                <ItemsControl ItemsSource="{Binding SqlPerformanceCategory.Issues}"
                                             Visibility="{Binding SqlPerformanceCategory.Issues.Count, Converter={StaticResource IntToVisibilityConverter}}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Mode=OneWay}" FontSize="11" Foreground="#F44336" Margin="0,2"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <ItemsControl ItemsSource="{Binding SqlPerformanceCategory.Improvements}"
                                             Visibility="{Binding SqlPerformanceCategory.Improvements.Count, Converter={StaticResource IntToVisibilityConverter}}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Mode=OneWay}" FontSize="11" Foreground="#4CAF50" Margin="0,2"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>

                        <!-- Index Health Category -->
                        <Border Background="#F3E5F5" BorderBrush="#9C27B0" BorderThickness="2" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                            <StackPanel>
                                <Grid>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding IndexHealthCategory.StatusIcon}" FontSize="24" Margin="0,0,10,0"/>
                                        <TextBlock Text="{Binding IndexHealthCategory.Name}" FontSize="18" FontWeight="Bold" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                        <TextBlock Text="{Binding IndexHealthCategory.Score}" FontSize="28" FontWeight="Bold"
                                                  Foreground="{Binding IndexHealthCategory.StatusColor}" VerticalAlignment="Center"/>
                                        <TextBlock Text="/100" FontSize="14" Foreground="#757575" Margin="2,6,0,0"/>
                                    </StackPanel>
                                </Grid>

                                <Border Background="{Binding IndexHealthCategory.StatusColor}" Height="6" CornerRadius="3" Margin="0,10,0,10"
                                       Width="{Binding IndexHealthCategory.Score}" HorizontalAlignment="Left" MaxWidth="400"/>

                                <TextBlock Text="{Binding IndexHealthCategory.StatusText}" FontWeight="SemiBold" FontSize="12"
                                          Foreground="{Binding IndexHealthCategory.StatusColor}" Margin="0,0,0,10"/>

                                <ItemsControl ItemsSource="{Binding IndexHealthCategory.Issues}"
                                             Visibility="{Binding IndexHealthCategory.Issues.Count, Converter={StaticResource IntToVisibilityConverter}}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Mode=OneWay}" FontSize="11" Foreground="#F44336" Margin="0,2"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <ItemsControl ItemsSource="{Binding IndexHealthCategory.Improvements}"
                                             Visibility="{Binding IndexHealthCategory.Improvements.Count, Converter={StaticResource IntToVisibilityConverter}}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Mode=OneWay}" FontSize="11" Foreground="#4CAF50" Margin="0,2"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>

                        <!-- Batch Jobs Category -->
                        <Border Background="#FFF3E0" BorderBrush="#FF9800" BorderThickness="2" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                            <StackPanel>
                                <Grid>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding BatchJobsCategory.StatusIcon}" FontSize="24" Margin="0,0,10,0"/>
                                        <TextBlock Text="{Binding BatchJobsCategory.Name}" FontSize="18" FontWeight="Bold" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                        <TextBlock Text="{Binding BatchJobsCategory.Score}" FontSize="28" FontWeight="Bold"
                                                  Foreground="{Binding BatchJobsCategory.StatusColor}" VerticalAlignment="Center"/>
                                        <TextBlock Text="/100" FontSize="14" Foreground="#757575" Margin="2,6,0,0"/>
                                    </StackPanel>
                                </Grid>

                                <Border Background="{Binding BatchJobsCategory.StatusColor}" Height="6" CornerRadius="3" Margin="0,10,0,10"
                                       Width="{Binding BatchJobsCategory.Score}" HorizontalAlignment="Left" MaxWidth="400"/>

                                <TextBlock Text="{Binding BatchJobsCategory.StatusText}" FontWeight="SemiBold" FontSize="12"
                                          Foreground="{Binding BatchJobsCategory.StatusColor}" Margin="0,0,0,10"/>

                                <ItemsControl ItemsSource="{Binding BatchJobsCategory.Issues}"
                                             Visibility="{Binding BatchJobsCategory.Issues.Count, Converter={StaticResource IntToVisibilityConverter}}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Mode=OneWay}" FontSize="11" Foreground="#F44336" Margin="0,2"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <ItemsControl ItemsSource="{Binding BatchJobsCategory.Improvements}"
                                             Visibility="{Binding BatchJobsCategory.Improvements.Count, Converter={StaticResource IntToVisibilityConverter}}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Mode=OneWay}" FontSize="11" Foreground="#4CAF50" Margin="0,2"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>

                        <!-- Database Size Category -->
                        <Border Background="#E8EAF6" BorderBrush="#3F51B5" BorderThickness="2" CornerRadius="8" Padding="15">
                            <StackPanel>
                                <Grid>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding DatabaseSizeCategory.StatusIcon}" FontSize="24" Margin="0,0,10,0"/>
                                        <TextBlock Text="{Binding DatabaseSizeCategory.Name}" FontSize="18" FontWeight="Bold" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                        <TextBlock Text="{Binding DatabaseSizeCategory.Score}" FontSize="28" FontWeight="Bold"
                                                  Foreground="{Binding DatabaseSizeCategory.StatusColor}" VerticalAlignment="Center"/>
                                        <TextBlock Text="/100" FontSize="14" Foreground="#757575" Margin="2,6,0,0"/>
                                    </StackPanel>
                                </Grid>

                                <Border Background="{Binding DatabaseSizeCategory.StatusColor}" Height="6" CornerRadius="3" Margin="0,10,0,10"
                                       Width="{Binding DatabaseSizeCategory.Score}" HorizontalAlignment="Left" MaxWidth="400"/>

                                <TextBlock Text="{Binding DatabaseSizeCategory.StatusText}" FontWeight="SemiBold" FontSize="12"
                                          Foreground="{Binding DatabaseSizeCategory.StatusColor}" Margin="0,0,0,10"/>

                                <ItemsControl ItemsSource="{Binding DatabaseSizeCategory.Issues}"
                                             Visibility="{Binding DatabaseSizeCategory.Issues.Count, Converter={StaticResource IntToVisibilityConverter}}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Mode=OneWay}" FontSize="11" Foreground="#F44336" Margin="0,2"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <ItemsControl ItemsSource="{Binding DatabaseSizeCategory.Improvements}"
                                             Visibility="{Binding DatabaseSizeCategory.Improvements.Count, Converter={StaticResource IntToVisibilityConverter}}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Mode=OneWay}" FontSize="11" Foreground="#4CAF50" Margin="0,2"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- Recommended Actions -->
            <Border Grid.Column="1" Background="White" BorderBrush="#E0E0E0" BorderThickness="2"
                   CornerRadius="10" Padding="20" Margin="10,0,0,0">
                <StackPanel>
                    <TextBlock Text="🎯 Empfohlene Aktionen" FontSize="18" FontWeight="Bold" Margin="0,0,0,15"/>

                    <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="600">
                        <ItemsControl ItemsSource="{Binding RecommendedActions}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#F5F5F5" BorderBrush="#E0E0E0" BorderThickness="1"
                                           CornerRadius="8" Padding="12" Margin="0,0,0,10" Cursor="Hand">
                                        <Border.InputBindings>
                                            <MouseBinding MouseAction="LeftClick"
                                                         Command="{Binding DataContext.ShowActionDetailsCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                         CommandParameter="{Binding}"/>
                                        </Border.InputBindings>

                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                                <Border Background="{Binding PriorityColor}" CornerRadius="3" Padding="5,2">
                                                    <TextBlock Text="{Binding Priority}" Foreground="White"
                                                              FontSize="9" FontWeight="Bold"/>
                                                </Border>
                                                <TextBlock Text="{Binding ActionType}" FontSize="9" FontWeight="SemiBold"
                                                          Foreground="#757575" Margin="8,0,0,0" VerticalAlignment="Center"/>
                                            </StackPanel>

                                            <TextBlock Text="{Binding Title}" FontSize="13" FontWeight="Bold" TextWrapping="Wrap" Margin="0,0,0,5"/>
                                            <TextBlock Text="{Binding Description}" FontSize="10" TextWrapping="Wrap" Foreground="#757575" Margin="0,0,0,8"/>

                                            <Grid>
                                                <TextBlock FontSize="10" Foreground="#757575">
                                                    <Run Text="Impact:"/>
                                                    <Run Text="{Binding EstimatedScoreImpact, StringFormat={}+{0} Punkte}" FontWeight="Bold" Foreground="#4CAF50"/>
                                                    <Run Text=" | Time:"/>
                                                    <Run Text="{Binding EstimatedTimeMinutes, StringFormat={}{0} min}" FontWeight="Bold"/>
                                                </TextBlock>

                                                <TextBlock Text="🤖" FontSize="12" HorizontalAlignment="Right"
                                                          Visibility="{Binding IsAutomatable, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                          ToolTip="Automatisierbar"/>
                                            </Grid>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Empty State -->
        <Border Grid.Row="3" Background="#F5F5F5" BorderBrush="#E0E0E0" BorderThickness="2"
               CornerRadius="10" Padding="40"
               Visibility="{Binding CurrentHealthScore, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="🏥" FontSize="80" HorizontalAlignment="Center" Opacity="0.3"/>
                <TextBlock Text="Noch kein Health Score berechnet" FontSize="20" FontWeight="Bold"
                          HorizontalAlignment="Center" Margin="0,20,0,10"/>
                <TextBlock Text="Klicken Sie auf 'Health Score Berechnen' um zu starten"
                          FontSize="14" Foreground="#757575" HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>

